# 인증(authentication)

### 세션 기반 인증

> - Session과 Cookie를 사용하여 인증하는 방식이다.
> - Token 방식보다 보안이 좋다.
>
> #### 과정
>
> 1. 유저가 로그인을 하게 되면 `세션이 서버 메모리 상에 저장`된다. 이 때 세션을 식별하기 위한 Session Id를 기준으로 정보를 저장한다.
> 2. 브라우저에 쿠키로 Session Id가 저장된다.
> 3. 쿠키가 정보가 담겨있기 때문에 브라우저는 해당 사이트에 대한 모든 Request에 Session ID를 쿠키에 담아 전송한다.
> 4. 서버는 클라이언트가 보낸 Session Id와 서버 메모리로 관리하고 있는 Session Id를 비교하여 Verification을 수행한다.
>
> #### 장점
>
> - 구현이 명확하고 실제 서버에서 로그인 상태 확인이 유용하다.
> - 토큰 방식에 Signature 등 부가적인 정보가 없기 때문에 Server와 Client 간 주고 받는 데이터가 적다.
> - 상대적으로 안전하다. 서버측에서 관리하기 때문에 클라이언트 변조에 영향받거나 데이터의 손상 우려가 없다.
>
> #### 단점
>
> - 유저들의 세션에 대한 정보를 서버 메모리에 들고 있게 되어 부담이 있다.
> - 서버 메모리에 서션 정보가 저장되기 때문에 Scale Out / Scale in이 부담이 될 수 있으며, 유저 상태에 무관하게 동작할 수 있도록 Data-Driven 아키텍처가 요구된다.
> - 멀티 디바이스 환경에서 로그인 시 신경써줘야할 부분들이 생긴다.
> - 쿠키는 단일 도메인 또는 서브 도메인에만 작동되기 때문에 여러 도메인을 사용할 경우 관리해주어야 한다.

### Token 기반 인증

> - SPA(Single Page Application)에서 많이 쓰인다.
> - JWT(JSON Web Token)을 많이 사용한다.
>   - 기본 구성 : Header.Payload.Signature(xxxx.yyyy.zzzz)
>   - Header : JWT인 토큰의 유형이나 해시 알고리즘(HMAC, SHA256, RSA 등)이 무엇으로 사용했는지 등 정보가 담긴다.
>   - Payload : 클라이언트에 대한 정보나 meta Data같은 내용이 들어있고 Base64Url로 인코딩 되어있다.
>     - JWT는 내용을 해독해 볼 수 있으므로 중요한 데이터를 포함해선 안된다.(해독시 받는 자가 secret 키를 알고 있어야 한다.)
>   - Signature : Header에서 지정한 알고리즘과  secret 키, 서명으로 payload와 Header를 담는다.
> - Session 기반 인증 방식의 가장 큰 차이점은 유저의 정보가 서버에 저장되지 않는다는 점이다.
> - Token 기반 인증은 Token에 대한 Verification만 수행할 뿐 저장은 클라이언트에서 수행한다.
>
> #### 수명
>
> - JWT의 수명을 짧게 하고 정기적으로 재발급을 요구하면 원치 않는 클라이언트를 빨리 막을 수 있다.
> - 수명이 짧다면 만료될 때마다 로그인을 해주어야 한다.
> - 수명이 길면 해커에게 해독되어 사용될 가능성이 높아진다.
> - Refresh Token으로 발급 받은 토큰이 만료되면 알아서 갱신할 수 있다.
>
> #### 과정
>
> - 유저가 로그인을 하고 서버에 세션을 이용해서 정보를 기록하는 대신, Token을 발급한다.
> - `클라이언트는 발급된 Token을 저장`한다.(일반적으로 local storage에 저장한다.)
> - 클라이언트는 요청 시 저장된 Token을 Header에 포함시켜 보낸다.
> - 서버는 매 요청시 클라이언트로부터 전달받은 Header의 Token 정보를 Verification 한 뒤, 해당 유저에 권한을 인가한다.
>
> #### 장점
>
> - 클라이언트에 저장됙 때문에 서버의 메모리에 부담이 되지 않으며 Scale에 있어 대비책을 고려할 필요가 없다.
> - 멀티 디바이스 환경에 대한 부담이 없다.
>
> #### 단점
>
> - 상대적으로 손상의 위험이 크다.
> - 구현을 하답조면 서버측에 Token blacklist를 관리하게 될 가능성이 있고 그렇게 되면 서버측 메모리의 소모가 발생한다.
> - 토큰 인증을 위해 DB를 매번 조회해야하기 때문에 DB에 성능 부하가 있을 수 있다.
> - Token은 일반적으로 Session Id보다 길다.
> - XSS(크로스 사이트 스크립팅) 공격에 취약할 수 있어 가능한 민감한 정보는 포함시키지 않을 필요가 있다.
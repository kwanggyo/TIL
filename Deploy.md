# `08.10`

# 배포

## NGINX

High performance load balancer, web server, API gateway & reverse proxy

비동기 방식이기 때문에 매우 높은 성능

정적인 파일(주로 프론트엔트 파일들)을 서비스할 때 뛰어난 성능(vs톰캣)

load balancer나 API gateway용도로도 사용 가능

브라우저와 연동할 때 80 or 443번 포트를 쓴다.

## 프론트엔드와 백엔드의 분기

/ 로 들어오는 요청은 프론트엔드의 라우터로

/api 로 들어오는 요청은 벤엔드로 보낸다.

Webserver로서의 역할

API gateway로서의 역할

### 코드

root : 빌드된 파일을 dist에 위치

index : index가 되는 파일명 지정

location/ : /로 들어온 요청에 index.html로 응답해준다. → 프론트엔드의 라우터가 받아서 FE에서 처리

localhost:8399 : 백엔드 서버가 8399에서 돌고 있구나로 이해

## 도커를 쓰는 이유

빠르게 필요한 서버를 증설할 수 있다.

기존에는  VM을 증설하는 방식을 사용했음 → VM이 부팅되는 1분이면 서비스 전체가 중지되기에 충분한 시간(수강 신청, 이벤트 등)

운영체제를 부팅해야 하는 기존의 방식보다 빠르다.

이미지를 만들어두면 찍어내기만 하면 되는 배포의 편의성(w/w8s) → 버전이 잘못되는 경우를 막아줌(미리 설정한 버전으로)

## 어디까지 도커화 할까?

프론트엔드, 백엔드는 필수적

배포의 효율성과 편의성을 생각하면서

DB / Jenkins / nginx는 선택적

(DB를 이미지화해서 새로 배포할 일이 많이 있을까?, 옮긴다면 데이터는?, 빌드 서버를 병렬적으로 추가 증설하는 경우는? 등)

## 임의의 포트를 사용하면?

ISP(SKT, KT, LG 등)에 따라서 닫혀 있는 포트가 존재

어느 곳에서는 되고, 어느 곳에서는 안되는 서비스가 될 수 있다.

→ 고객은 포트가 막혔을 거라고 생각하지 않고 이탈한다.

## Gitlab → Jenkins

개발자가 gitlab의 특정 브랜치(develop or master)에 머지를 하면 이벤트가 트리거되어 jenkins에서 빌드를 시작한다.

빌드가 완료되면 도커 이미지가 제작되어 배포된다.

동일한 도커 이미지로 제작, 배포되기 때문에 동일성이 보장된다.

## SSL(→ TLS)

회원 가입 시에 비밀번호 등의 개인 정보가 전송되고, 수시로 유출되어서는 안되는 정보들이 오가기 때문에 암호화가 필요하다.

매번 데이터를 암호화해서 전송하기 어렵기 때문에 TLS(Transport Layer Security)를 사용한다.

이론적으로는 TLS을 활용한 통신은 안전하다고 볼 수 있다.

## Cert Bot

Https 확산을 위해서 시작된 비영리 프로젝트(Let's encrypt)

상용 프로그램을 제작할 때는 보통 신뢰할 수 있는 ROOT 인증서 발급자로부터 SSL 인증서를 구매해서 사용한다.

nginx나 백엔드 서버 모두에 설정이 필요하다.

## 사용자 계정 만들기

각 프로그램들을 실행할 때는 프로그램에 맞는 권한을 가진 사용자 계정을 만들어서 실행한다.

ubuntu 계정이나 심지어 root 계정으로 실행하는 경우에는 해커의 공격 명령이 그 계정의 권한으로 실행되기 때문에 매우 위험하다.

사용자 계정으로 실행하는 경우 해커의 공격을 받더라도 피해를 최소화 할 수 있다.배포